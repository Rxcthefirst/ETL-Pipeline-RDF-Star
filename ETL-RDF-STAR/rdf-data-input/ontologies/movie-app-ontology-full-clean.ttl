@prefix ex: <http://example.org/movieApp#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

################################################################
# Ontology Header
################################################################

ex:MovieAppOntology a owl:Ontology .

################################################################
# Classes
################################################################

ex:User a owl:Class .

ex:Movie a owl:Class .

ex:Post a owl:Class .

ex:Review a owl:Class ;
    rdfs:subClassOf ex:Post .

ex:Comment a owl:Class ;
    rdfs:subClassOf ex:Post .

ex:Rating a owl:Class .

################################################################
# Disjoint Classes
################################################################

# Users, Movies, and Posts are disjoint â€” no resource can belong to more than one
[ a owl:AllDisjointClasses ;
  owl:members (ex:User ex:Movie ex:Post)
] .

################################################################
# Object Properties
################################################################

ex:hasPosted a owl:ObjectProperty, owl:FunctionalProperty ;
    rdfs:domain ex:User ;
    rdfs:range ex:Post ;
    owl:inverseOf ex:isPostedBy .

ex:isPostedBy a owl:ObjectProperty ;
    rdfs:domain ex:Post ;
    rdfs:range ex:User .

ex:hasRating a owl:ObjectProperty, owl:FunctionalProperty ;
    rdfs:domain ex:User ;
    rdfs:range ex:Rating .

ex:ratesMovie a owl:ObjectProperty ;
    rdfs:domain ex:Rating ;
    rdfs:range ex:Movie .

################################################################
# Data Properties
################################################################

ex:hasEmail a owl:DatatypeProperty, owl:FunctionalProperty ;
    rdfs:domain ex:User ;
    rdfs:range xsd:string .

ex:hasUsername a owl:DatatypeProperty, owl:FunctionalProperty ;
    rdfs:domain ex:User ;
    rdfs:range xsd:string .

ex:hasRatingValue a owl:DatatypeProperty ;
    rdfs:domain ex:Rating ;
    rdfs:range xsd:integer .

################################################################
# Class Restrictions
################################################################

# Users must have an email matching a pattern
ex:User rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty ex:hasEmail ;
    owl:allValuesFrom [
        a rdfs:Datatype ;
        owl:onDatatype xsd:string ;
        owl:withRestrictions (
            [ xsd:pattern ".+@.+\\..+" ]
        )
    ]
] .

# Ratings must have a value between 1 and 10
ex:Rating rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty ex:hasRatingValue ;
    owl:allValuesFrom [
        a rdfs:Datatype ;
        owl:onDatatype xsd:integer ;
        owl:withRestrictions (
            [ xsd:minInclusive "1"^^xsd:integer ]
            [ xsd:maxInclusive "10"^^xsd:integer ]
        )
    ]
] .

# Posts must be created by exactly one User
ex:Post rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty ex:isPostedBy ;
    owl:qualifiedCardinality "1"^^xsd:nonNegativeInteger ;
    owl:onClass ex:User
] .

# Ratings must be given by exactly one User and for exactly one Movie
ex:Rating rdfs:subClassOf [
    a owl:Restriction ;
    owl:onProperty ex:ratesMovie ;
    owl:qualifiedCardinality "1"^^xsd:nonNegativeInteger ;
    owl:onClass ex:Movie
] , [
    a owl:Restriction ;
    owl:onProperty ex:isPostedBy ;
    owl:qualifiedCardinality "1"^^xsd:nonNegativeInteger ;
    owl:onClass ex:User
] .

################################################################
# Notes:
# - Subclassing: Review and Comment are special types of Posts.
# - Disjoint Classes: Users, Movies, Posts are totally distinct.
# - Functional Properties: Email and Username must be unique per User.
# - Data Restrictions: 
#    * Rating between 1 and 10
#    * Email must match basic email format
################################################################
