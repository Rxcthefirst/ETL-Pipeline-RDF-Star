<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph Explorer - SPARQL Client & YARRRML Builder</title>
    <link rel="stylesheet" href="/static/css/sparql-client.css">
    <link rel="stylesheet" href="/static/css/class-explorer.css?v=6">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                </svg>
                Knowledge Graph Explorer
            </h1>
            <div class="header-actions">
                <!-- Mode Switcher -->
                <div class="mode-switcher">
                    <button class="mode-btn active" data-mode="explorer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                        Explorer
                    </button>
                    <button class="mode-btn" data-mode="class-explorer">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3"/><circle cx="5" cy="6" r="2"/><circle cx="19" cy="6" r="2"/><circle cx="5" cy="18" r="2"/><circle cx="19" cy="18" r="2"/><line x1="12" y1="9" x2="7" y2="7" stroke="currentColor" stroke-width="1.5"/><line x1="12" y1="9" x2="17" y2="7" stroke="currentColor" stroke-width="1.5"/><line x1="12" y1="15" x2="7" y2="17" stroke="currentColor" stroke-width="1.5"/><line x1="12" y1="15" x2="17" y2="17" stroke="currentColor" stroke-width="1.5"/></svg>
                        Class Explorer
                    </button>
                    <button class="mode-btn" data-mode="yarrrml">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
                        YARRRML Builder
                    </button>
                </div>
                <span style="color: var(--text-secondary); font-size: 13px;">
                    Connected to: <strong style="color: var(--accent);">localhost:7878</strong>
                </span>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- =============================================
                 EXPLORER MODE
                 ============================================= -->
            <div id="explorer-mode">
                <!-- Query Section -->
                <div style="display: flex; flex-direction: column; flex: 1;">
                    <section class="query-section">
                        <div class="query-editor-container">
                            <div class="query-editor">
                                <textarea id="query-input" placeholder="Enter your SPARQL query here...

Example - Show all customers with competing claims:
SELECT ?customer ?name ?score ?source ?confidence ?timestamp ?graph
WHERE {
    GRAPH ?graph {
        ?customer a <http://schema.org/Person> ;
                  <http://xmlns.com/foaf/0.1/name> ?name ;
                  <http://schema.org/creditScore> ?score .
        OPTIONAL {
            ?reifier <http://www.w3.org/1999/02/22-rdf-syntax-ns#reifies> ?triple ;
                     <http://www.w3.org/ns/prov#wasDerivedFrom> ?source .
        }
    }
}"></textarea>
                            </div>
                            <div class="query-actions">
                                <button class="btn btn-primary" id="run-query">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M8 5v14l11-7z"/>
                                    </svg>
                                    Run
                                </button>
                                <button class="btn btn-secondary" id="clear-query">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                                    </svg>
                                    Clear
                                </button>
                            </div>
                        </div>
                        <div class="query-templates">
                            <select id="query-templates">
                                <option value="">-- Select a query template --</option>
                            </select>
                        </div>
                    </section>

                    <!-- Results Panel -->
                    <div class="results-panel">
                        <!-- Tabs -->
                        <div class="tabs">
                            <div class="tab active" data-tab="graph">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="6" cy="6" r="3"/>
                                    <circle cx="18" cy="6" r="3"/>
                                    <circle cx="12" cy="18" r="3"/>
                                    <line x1="6" y1="9" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
                                    <line x1="18" y1="9" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Graph
                            </div>
                            <div class="tab" data-tab="table">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 3h18v18H3V3zm16 16V5H5v14h14zM7 7h2v2H7V7zm4 0h6v2h-6V7zm-4 4h2v2H7v-2zm4 0h6v2h-6v-2zm-4 4h2v2H7v-2zm4 0h6v2h-6v-2z"/>
                                </svg>
                                Table
                            </div>
                            <div class="tab" data-tab="json">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                                </svg>
                                JSON
                            </div>
                        </div>

                        <!-- Tab Contents -->
                        <div id="graph-content" class="tab-content active">
                            <div id="graph-container">
                                <svg id="graph-canvas"></svg>
                                <div class="graph-controls">
                                    <button id="zoom-in" title="Zoom In">+</button>
                                    <button id="zoom-out" title="Zoom Out">−</button>
                                    <button id="zoom-fit" title="Fit to View">⊙</button>
                                </div>
                                <div class="loading-overlay hidden">
                                    <div class="spinner"></div>
                                </div>
                            </div>
                        </div>

                        <div id="table-content" class="tab-content">
                            <div id="table-container">
                                <div class="empty-state">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/>
                                    </svg>
                                    <h3>No Results Yet</h3>
                                    <p>Run a SPARQL query to see tabular results here.</p>
                                </div>
                            </div>
                        </div>

                        <div id="json-content" class="tab-content">
                            <div id="json-container">
                                <pre id="json-output">// JSON response will appear here after running a query</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Details Panel (Right Side) - Shows Competing Claims -->
                <aside class="details-panel collapsed">
                    <div class="details-header">
                        <h3>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                            </svg>
                            Entity Details
                        </h3>
                        <button id="close-details" class="btn btn-secondary" style="padding: 5px 10px;">
                            ✕
                        </button>
                    </div>
                    <div class="details-content">
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                            </svg>
                            <h3>Select an Entity</h3>
                            <p>Click on a node in the graph or a URI in the table to see all competing claims and provenance.</p>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- =============================================
                 CLASS EXPLORER MODE
                 ============================================= -->
            <div id="class-explorer-mode" style="display: none;">
                <div style="display: flex; flex-direction: column; flex: 1;">
                    <!-- Class Search Bar -->
                    <section class="query-section" style="flex: 0 0 auto;">
                        <div class="query-editor-container" style="align-items: center;">
                            <div style="flex: 1; position: relative;">
                                <input type="text" id="class-search-input"
                                       placeholder="Search for a class (e.g. Movie, User, Rating)..."
                                       style="width: 100%; padding: 10px 14px; font-size: 14px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-darker); color: var(--text-primary); outline: none;"
                                       autocomplete="off">
                                <div id="class-search-dropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; max-height: 300px; overflow-y: auto; background: var(--bg-darker); border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 6px 6px; z-index: 1000;"></div>
                            </div>
                        </div>
                    </section>

                    <!-- Results Panel (reuses same structure as explorer) -->
                    <div class="results-panel">
                        <div class="tabs">
                            <div class="tab active" data-tab="ce-graph">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><circle cx="12" cy="18" r="3"/>
                                    <line x1="6" y1="9" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
                                    <line x1="18" y1="9" x2="12" y2="15" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Graph
                            </div>
                            <div class="tab" data-tab="ce-table">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 3h18v18H3V3zm16 16V5H5v14h14zM7 7h2v2H7V7zm4 0h6v2h-6V7zm-4 4h2v2H7v-2zm4 0h6v2h-6v-2zm-4 4h2v2H7v-2zm4 0h6v2h-6v-2z"/>
                                </svg>
                                Table
                            </div>
                            <div class="tab" data-tab="ce-json">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                                </svg>
                                JSON
                            </div>
                        </div>

                        <div id="ce-graph-content" class="tab-content active">
                            <div id="ce-graph-container" style="position: relative; width: 100%; height: 100%;">
                                <svg id="ce-graph-canvas"></svg>
                                <div class="graph-controls">
                                    <button id="ce-zoom-in" title="Zoom In">+</button>
                                    <button id="ce-zoom-out" title="Zoom Out">−</button>
                                    <button id="ce-zoom-fit" title="Fit to View">⊙</button>
                                </div>
                                <div id="ce-loading" class="loading-overlay hidden"><div class="spinner"></div></div>
                            </div>
                        </div>

                        <div id="ce-table-content" class="tab-content">
                            <div id="ce-table-container">
                                <div class="empty-state">
                                    <h3>No Class Selected</h3>
                                    <p>Search for a class above to see its relationships in a table.</p>
                                </div>
                            </div>
                        </div>

                        <div id="ce-json-content" class="tab-content">
                            <div id="ce-json-container">
                                <pre id="ce-json-output">// Select a class to see its graph data as JSON</pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right panel for class properties -->
                <aside id="ce-details-panel" class="details-panel collapsed">
                    <div class="details-header">
                        <h3>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                            </svg>
                            Class Details
                        </h3>
                        <button id="ce-close-details" class="btn btn-secondary" style="padding: 5px 10px;">✕</button>
                    </div>
                    <div id="ce-details-content" class="details-content">
                        <div class="empty-state">
                            <h3>Select a Class</h3>
                            <p>Click a node in the graph or right-click for more options.</p>
                        </div>
                    </div>
                </aside>
            </div>

            <!-- Right-click context menu -->
            <div id="ce-context-menu" style="display: none; position: fixed; z-index: 10000; min-width: 220px; background: var(--bg-darker); border: 1px solid var(--border-color); border-radius: 6px; box-shadow: 0 8px 24px rgba(0,0,0,0.4); overflow: hidden;">
                <div class="ce-ctx-item" data-action="add-neighbors" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                    Add All Neighbors
                </div>
                <div class="ce-ctx-item" data-action="add-superclasses" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14l5-5 5 5H7z"/></svg>
                    Add Super Classes
                </div>
                <div class="ce-ctx-item" data-action="add-subclasses" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5H7z"/></svg>
                    Add Sub Classes
                </div>
                <div class="ce-ctx-item" data-action="load-individuals" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.2 0 4-1.8 4-4s-1.8-4-4-4-4 1.8-4 4 1.8 4 4 4zm0 2c-2.7 0-8 1.3-8 4v2h16v-2c0-2.7-5.3-4-8-4z"/></svg>
                    Load Individuals
                </div>
                <div class="ce-ctx-item" data-action="view-properties" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"/></svg>
                    View Properties
                </div>
                <div class="ce-ctx-item" data-action="view-individual-details" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                    View Details
                </div>
                <div class="ce-ctx-item" data-action="expand-connections" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/></svg>
                    Expand Connections
                </div>
                <div class="ce-ctx-item" data-action="link-to-types" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: var(--text-primary); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/></svg>
                    Link to Class Types
                </div>
                <div class="ce-ctx-item" data-action="remove-node" style="padding: 10px 16px; cursor: pointer; font-size: 13px; color: #e74c3c; display: flex; align-items: center; gap: 8px;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="#e74c3c"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
                    Remove from Graph
                </div>
            </div>

            <!-- =============================================
                 YARRRML BUILDER MODE
                 ============================================= -->
            <div id="yarrrml-mode" style="display: none;">
                <div id="yarrrml-builder" style="display: flex; flex: 1; width: 100%;">
                    <!-- Content rendered by yarrrml-builder.js -->
                    <div class="yarrrml-wizard">
                        <div class="wizard-content">
                            <div class="empty-state">
                                <h3>Loading YARRRML Builder...</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-item">
                <span class="status-indicator"></span>
                <span class="status-text">Ready</span>
            </div>
            <div class="status-item">
                <span>Explorer: Ctrl+Enter to run query | YARRRML: Visual mapping designer</span>
            </div>
        </footer>
    </div>

    <script src="/static/js/sparql-client.js"></script>
    <script src="/static/js/yarrrml-builder.js"></script>
    <script src="/static/js/class-explorer.js?v=7"></script>
</body>
</html>

